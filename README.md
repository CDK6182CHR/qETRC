# qETRC

Electronic Train Running Chart implemented with Qt

本项目是对此前的[pyETRC](https://github.com/CDK6182CHR/train_graph)项目的C++重构版本，工程名暂定为qETRC。本项目基于GPLv3协议开放源代码，在协议允许范围内，作者保留一切权利和最终解释权。

**此项目尚在开发中，主要功能还远未实现**。

联系方式：mxy0268@qq.com



## 基本概念

本项目数据的最高级别抽象（i.e. 最大范围）为**运行图**(`Diagram`)，每个程序实例在同一时刻仅处理一个运行图对象。每个运行图对象含有以下基础数据：

- 一组**基线**数据 （`Railway`）
- 一组**列车**数据 （`Train`）

除此之外，每个运行图可以具有若干个**视窗**/**页面** （`DiagramPage`），它与程序图形界面中的运行图窗口（`DiagramWidget`）是一一对应的。每个运行图页面可以包含一条或者多条基线。

在设计数据结构和算法时，原则上，考虑以下数据规模：

- 列车数量约在**1000量级**。

- 每条基线的车站数量约在**100量级**。

  > 以上两项数据规模与pyETRC通常能处理的数据规模类似。在此框架下，程序中将尽量避免对这两项数据进行线性查找，回避平方以上复杂度的算法。

- 基线数量约在**10量级**。

- 运行图视窗约在**10量级**。

  > 以上两项为初期设计原则，即项目初期仅仅考虑少量线路集合的运行图文件。对于线路和运行图视窗，将不介意采用线性查找。



## 项目结构

项目目前的文件结构大致为：

- `data` 数据部分。运行图、基线、列车等数据结构的实现。
  - `common` 比较简单的公共数据结构，例如站名`StationName`
  - `rail` 铁路线路数据。总成在`Railway`类中，包含以下几个部分：
    - `RailStation` 一个车站，包括站名、延长公里等。
    - `RailInterval` 两个车站的一个区间。这是相比于pyETRC新增的数据结构。
    - 基于线路区间的数据，包括标尺`Ruler`、天窗`Forbid`。
  - `train` 列车数据结构。主要包括
    - `Train` 列车，包含车次、时刻表以及始发终到站等数据。
    - `Routing` 交路。是一组列车的序列。
    - `TrainCollection` 列车集合。包含一组列车、一组交路和一套列车类型系统。
  - `diagram` 运行图级别数据结构。主要包括运行图`Diagram`和运行图页面`DiagramPage`等。
- `dialogs` 一些基于对话框实现的较为简单的功能，例如导入车次`ImportTrainDialog`。
- `editors` 原pyETRC中采用停靠面板实现的、核心数据结构的编辑控件，例如线路里程编辑、车次编辑等。
- `kernel` 绘图核心模块，实现运行图绘制。
- `mainwindow` 程序主窗口以及相关的界面逻辑类。
- `model` 基于Qt的Model/View框架设计的数据模型。其中
  - `delegate` 编辑的代理类。
  - `train` 与列车相关的模型，例如时刻表。
  - `rail` 与线路相关的模型，例如线路里程表。
  - `diagram` 超过以上两个抽象层次的模型。
- `navi` 是qETRC新增部分，与导航窗口相关的界面程序。
- `viewers` 原pyETRC中，运行图分析的功能，例如事件表等。
- `railnet` 中远期规划，原pyETRC线网管理模块的功能。
- `util` 一些杂项，对Qt的轻度扩展等。

