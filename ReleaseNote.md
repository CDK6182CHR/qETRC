# qETRC列车运行图系统

## 概要

本软件是原pyETRC列车运行图系统的C++重构版本，主要支持列车运行图的绘制、管理、分析等功能。原pyETRC软件原则上不再进行维护。本软件主要在`Windows 10`, `Qt 5.15`, `MSVC 2019`环境下开发和测试。

- 作者：萧迩珀；联系方式：mxy0268@qq.com

- 本系统官方交流群（与pyETRC一致）：865211882

- 本项目开源库：

  - https://github.com/CDK6182CHR/qETRC 
  - https://gitee.com/xep0268/qETRC/

  原则上两边同步更新。

- 原pyETRC系统开源地址：https://github.com/CDK6182CHR/train_graph。

**声明**：

- 本系统按照GPL协议开放源代码。在法律和协议允许范围内，作者保留一切权利。

#### 致谢

- “LGuo的电子运行图”软件（`ETRC`）。本软件最初的开发工作由此而起，并参考该软件较多功能。本软件支持读取和导出其运行图文件。

- [Advanced-Docking-System](https://github.com/githubuser0xFFFF/Qt-Advanced-Docking-System)：提供了任意组织停靠面板的功能。
- [SARibbon](https://github.com/czyt1988/SARibbon): 提供了Ribbon风格工具栏的功能。

## 运行说明

作者提供Win64构建的二进制版本，可以直接运行；也可以从开源库拉取源代码，自行构建。

- win64发行版目前采用MSVC编译器构建，可能需要MSVC的运行时库。
- 源代码构建提示：至少需要Qt5 （小版本号的要求暂不确定，开发用的是5.15），支持C++17标准的编译器。建议采用MSVC 2019。

## 版本更新日志

### 2021年9月13日 发布0.5.1版本 (R3)

更新日志 (0.5.0->0.5.1)

1. 【pyETRC既有功能移植】时刻表插值（通过站时刻推定）功能，基于标尺，推定车次时刻表中，未给出时刻的车站的通过时刻。操作逻辑与pyETRC基本一致，但基于qETRC的数据结构重新设计了底层算法逻辑，理论上更加安全和严谨。此功能位于工具栏：`列车(3)`-`排图`-`时刻插值`。
2. 修复间隔分析的算法，解决（理论上）特殊情况下（运行线端点站出现类似待避情况）导致待避间隔判定错误的问题。同时在`间隔汇总`窗口设置Flag为`Window`，方便窗口最大化操作。

### 2021年9月10日 发布0.5.0版本 (R2)

更新日志 (0.4.0->0.5.0)

1. 【qETRC新设计功能（模块）】新增车站列车间隔分析的相关功能。位于工具栏的线路上下文菜单，提供`间隔分析`和`间隔汇总`两个入口。前者给出指定车站的详细间隔表，后者一次性统计全线所有车站的最短间隔。在车站事件表中增加间隔分析的入口。
2. 【qETRC新设计功能】新增运行图定位功能。通过输入时刻，选择线路及其车站，或指定里程标，在运行图窗口上标记处相应位置，快捷键为<kbd>Ctrl</kbd>+<kbd>G</kbd>，工具栏位于`线路(3)`->`定位`。
   同时在`列车事件表`、`车站事件表`、`断面事件表`、`线路快照`和`间隔分析`的表格中支持右键快速定位到相应事件。



### 2021年9月5日 发布0.4.0版本 (R1)

从这个版本开始标记Release编号。

自0.3.1版本以来新增的功能：

1. 系统默认运行图设置，以及将当前运行图设置保存为默认设置、将默认设置应用到当前运行图。在`显示`工具栏中。
2. 全局设置选项，在`显示`工具栏中，包括表格行高等设置项。这些设置项自动保存。
3. `速览时刻`功能，是pyETRC中`当前列车时刻表`和`交互式时刻表`功能的合并。调用快捷键为<kbd>Ctrl</kbd>+<kbd>I</kbd>。可以通过`编辑`复选框来决定是否允许修改。如果启用编辑，则修改的时刻立即生效。
4. `速览信息`功能，即pyETRC中的`当前车次信息`功能。调用快捷键仍为<kbd>Ctrl</kbd>+<kbd>Q</kbd>。以上两项的停靠面板默认在运行图右侧显示。
5. 初步完成`列车筛选器`功能，与pyETRC中的列车筛选器基本一致，在全局支持按筛选器来选择要显示的车次，快捷键仍为<kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>L</kbd>。
6. 各种杂项修改。